<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ì—­ ì‚¬ì´íŠ¸ ë§¤ë‹ˆì €</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .add-form {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-add {
            background: #667eea;
            color: white;
            flex: 1;
        }

        .btn-add:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: #e0e0e0;
            color: #666;
        }

        .btn-clear:hover {
            background: #d0d0d0;
        }

        .sites-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .site-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .site-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }

        .site-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .site-url {
            color: #0066cc;
            text-decoration: none;
            word-break: break-all;
            font-size: 0.9em;
            margin-bottom: 10px;
            display: block;
        }

        .site-url:hover {
            text-decoration: underline;
        }

        .site-desc {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .card-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit, .btn-delete {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #4CAF50;
            color: white;
        }

        .btn-edit:hover {
            background: #45a049;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .empty-state {
            text-align: center;
            color: white;
            padding: 40px;
            font-size: 1.2em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-save {
            background: #667eea;
            color: white;
            flex: 1;
        }

        .btn-save:hover {
            background: #5568d3;
        }

        .btn-cancel {
            background: #e0e0e0;
            color: #666;
            flex: 1;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .sites-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“¦ ë¬´ì—­ ì‚¬ì´íŠ¸ ë§¤ë‹ˆì €</h1>
            <p>ë¬´ì—­ ê´€ë ¨ ì‚¬ì´íŠ¸ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </header>

        <div class="add-form">
            <h2 style="margin-bottom: 20px; color: #333;">ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€</h2>
            <div class="form-group">
                <label for="siteName">ì‚¬ì´íŠ¸ ì´ë¦„</label>
                <input type="text" id="siteName" placeholder="ì˜ˆ: Alibaba, Global Sources">
            </div>
            <div class="form-group">
                <label for="siteUrl">ì›¹ì‚¬ì´íŠ¸ URL</label>
                <input type="url" id="siteUrl" placeholder="ì˜ˆ: https://www.alibaba.com">
            </div>
            <div class="form-group">
                <label for="siteDesc">ì„¤ëª…</label>
                <textarea id="siteDesc" placeholder="ì‚¬ì´íŠ¸ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="button-group">
                <button class="btn-add" onclick="addSite()">ì¶”ê°€</button>
                <button class="btn-clear" onclick="clearForm()">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div id="sitesList" class="sites-list"></div>
        <div id="emptyState" class="empty-state" style="display: none;">
            ì•„ì§ ë“±ë¡ëœ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ì‚¬ì´íŠ¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>ì‚¬ì´íŠ¸ ìˆ˜ì •</h2>
            <div class="form-group">
                <label for="editName">ì‚¬ì´íŠ¸ ì´ë¦„</label>
                <input type="text" id="editName">
            </div>
            <div class="form-group">
                <label for="editUrl">ì›¹ì‚¬ì´íŠ¸ URL</label>
                <input type="url" id="editUrl">
            </div>
            <div class="form-group">
                <label for="editDesc">ì„¤ëª…</label>
                <textarea id="editDesc"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn-save" onclick="saveEdit()">ì €ì¥</button>
                <button class="btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase ì´ˆê¸°í™”
        const SUPABASE_URL = 'https://nzkewzfsktdfwykjdmwl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56a2V3emZza3RkZnd5a2pkbXdsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MDgwNTQsImV4cCI6MjA4NjI4NDA1NH0.6UXcSFXuGJclsnGsVp9gyTrG635T5SoGycZAnjkoGs0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let sites = [];
        let editingId = null;
        let isLoading = false;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (ì´ˆê¸°í™” ì‹œ í•œ ë²ˆë§Œ)
        async function migrateLocalData() {
            const localData = JSON.parse(localStorage.getItem('tradeSites')) || [];
            if (localData.length > 0) {
                try {
                    console.log('ğŸ“¤ ë¡œì»¬ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘:', localData.length + 'ê°œ í•­ëª©');
                    for (const site of localData) {
                        await supabase.from('address_collection').insert({
                            id: site.id,
                            name: site.name,
                            url: site.url,
                            description: site.desc
                        });
                    }
                    localStorage.removeItem('tradeSites');
                    console.log('âœ… ë¡œì»¬ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜:', error);
                }
            }
        }

        // Supabaseì—ì„œ ëª¨ë“  ì‚¬ì´íŠ¸ ë¡œë“œ
        async function loadSites() {
            try {
                isLoading = true;
                console.log('ğŸ”„ Supabaseì—ì„œ ì‚¬ì´íŠ¸ ë¡œë“œ ì¤‘...');
                const { data, error } = await supabase
                    .from('address_collection')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                sites = data || [];
                console.log('âœ… ì‚¬ì´íŠ¸ ë¡œë“œ ì™„ë£Œ:', sites.length + 'ê°œ');
                renderSites();
            } catch (error) {
                console.error('âŒ ì‚¬ì´íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                isLoading = false;
            }
        }

        async function addSite() {
            const name = document.getElementById('siteName').value.trim();
            const url = document.getElementById('siteUrl').value.trim();
            const description = document.getElementById('siteDesc').value.trim();

            if (!name || !url) {
                alert('ì‚¬ì´íŠ¸ ì´ë¦„ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const id = Date.now();
                console.log('ğŸ“¤ Supabaseì— ë°ì´í„° ì „ì†¡ ì‹œì‘:', { id, name, url, description });

                const { data, error } = await supabase.from('address_collection').insert({
                    id,
                    name,
                    url,
                    description
                });

                if (error) {
                    console.error('âŒ Supabase ì˜¤ë¥˜:', error);
                    throw error;
                }

                console.log('âœ… ë°ì´í„° ì €ì¥ ì„±ê³µ:', data);
                clearForm();
                await loadSites();
            } catch (error) {
                console.error('âŒ ì‚¬ì´íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ì‚¬ì´íŠ¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message);
            }
        }

        function clearForm() {
            document.getElementById('siteName').value = '';
            document.getElementById('siteUrl').value = '';
            document.getElementById('siteDesc').value = '';
            document.getElementById('siteName').focus();
        }

        async function deleteSite(id) {
            if (confirm('ì´ ì‚¬ì´íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const { error } = await supabase
                        .from('address_collection')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    console.log('âœ… ì‚¬ì´íŠ¸ ì‚­ì œ ì™„ë£Œ:', id);
                    await loadSites();
                } catch (error) {
                    console.error('âŒ ì‚¬ì´íŠ¸ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ì‚¬ì´íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function openEditModal(id) {
            editingId = id;
            const site = sites.find(s => s.id === id);
            document.getElementById('editName').value = site.name;
            document.getElementById('editUrl').value = site.url;
            document.getElementById('editDesc').value = site.description || '';
            document.getElementById('editModal').classList.add('active');
            document.getElementById('editName').focus();
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            editingId = null;
        }

        async function saveEdit() {
            const name = document.getElementById('editName').value.trim();
            const url = document.getElementById('editUrl').value.trim();
            const description = document.getElementById('editDesc').value.trim();

            if (!name || !url) {
                alert('ì‚¬ì´íŠ¸ ì´ë¦„ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const { error } = await supabase
                    .from('address_collection')
                    .update({ name, url, description })
                    .eq('id', editingId);

                if (error) throw error;

                console.log('âœ… ì‚¬ì´íŠ¸ ìˆ˜ì • ì™„ë£Œ:', editingId);
                await loadSites();
                closeModal();
            } catch (error) {
                console.error('âŒ ì‚¬ì´íŠ¸ ìˆ˜ì • ì˜¤ë¥˜:', error);
                alert('ì‚¬ì´íŠ¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function renderSites() {
            const sitesList = document.getElementById('sitesList');
            const emptyState = document.getElementById('emptyState');

            if (sites.length === 0) {
                sitesList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            sitesList.innerHTML = sites.map(site => `
                <div class="site-card">
                    <div class="site-name">${escapeHtml(site.name)}</div>
                    <a href="${site.url}" target="_blank" class="site-url">${escapeHtml(site.url)}</a>
                    <div class="site-desc">${escapeHtml(site.description || '')}</div>
                    <div class="card-buttons">
                        <button class="btn-edit" onclick="openEditModal(${site.id})">ìˆ˜ì •</button>
                        <button class="btn-delete" onclick="deleteSite(${site.id})">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ëª¨ë‹¬ ë°”ê¹¥ìª½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Enter í‚¤ ì²˜ë¦¬
        document.getElementById('siteName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addSite();
        });

        document.getElementById('siteUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addSite();
        });

        document.getElementById('editUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveEdit();
        });

        // ì´ˆê¸°í™”
        async function init() {
            console.log('ğŸš€ ë¬´ì—­ ì•± ì‹œì‘!');
            console.log('ğŸ“ Supabase URL:', SUPABASE_URL);
            await migrateLocalData();
            await loadSites();
            console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        init();
    </script>
</body>
</html>